m18$Sex <- 'Male'
#----------------------------------------------------------------------------------
all <- rbind(f6,f12,f18,m6,m12,m18)
all$Month <- factor(all$Month,levels = c('6 Month','12 Month','18 Month'))
#genotype
type <- Load.branch('type.Rdata')
type$id <- as.numeric(gsub('Y','',type$Ear.tag))
all <- merge(all,type,all.x = T, all.y = F,
by.x = 'Subject',by.y = 'id')
#---------------------------------------------------------------------------------------------
#plot
ggplot(subset(all,Location=='Forelimb'),aes(y=Average.Value..g.,x=Month,group=Subject,color=Sex))+
geom_line()+theme_classic()
ggplot(subset(all,Location=='All limb'),aes(y=Average.Value..g.,x=Month,group=Subject,color=Sex))+
geom_line()+theme_classic()
ggplot(all,aes(y=Average.Value..g.,x=Month,group=Subject,color=Type))+
geom_line()+theme_classic()+facet_grid(~Location)
#-----------------------------------------------------------------------------------
#mix model
mix <- lmer(Average.Value..g.~Location+Type*Month+(Month|Subject),data = all)
summary(mix)
# End Program Body
dependency.out <- finalize_dependency()
ggplot(subset(all,Location=='Forelimb'),aes(y=Average.Value..g.,x=Month,group=Subject,color=Sex))+
geom_line()+theme_classic()
mix <- lmer(Average.Value..g.~Sex+Location+Type*Month+(Month|Subject),data = all)
summary(mix)
mixMale <- lmer(Average.Value..g.~Location+Type*Month+(Month|Subject),data = subset(all,Sex=="Male")
summary(mixMale)
mixMale <- lmer(Average.Value..g.~Location+Type*Month+(Month|Subject),data = subset(all,Sex=="Male"))
summary(mixMale)
mixFemale <- lmer(Average.Value..g.~Location+Type*Month+(Month|Subject),data = subset(all,Sex=="Female"))
summary(mixFemale)
mix <- lmer(Average.Value..g.~Sex+Location+Type*Month+(Month|Subject),data = all)
summary(mix)
library(adapr)
setProject("Pena")
showProject()
require("adapr")
require("methods")
require("knitr")
paste0("Created on ",(Sys.time() ))
#If TRUE then will "knit" in RStudio
if(TRUE){scriptLoader("Pena_549","read_data.R")}
Library(c("readxl","ggplot2"))
library(plyr)
library(dplyr)
labs <- lapply(listDatafiles()$file,function(x){readxl::read_xlsx(file.path(dataDir(),x),sheet="LabsIT")})
ecmos <- lapply(listDatafiles()$file,function(x){readxl::read_xlsx(file.path(dataDir(),x),sheet="Ecmo-K")})
labs[[5]] <- dplyr::select(labs[[5]],-date)
labs2 <- rbind.fill(labs)
labs2$PHGB <- as.numeric(gsub("<","",as.character(labs2$PHGB)))
ecmos <- rbind.fill(ecmos)
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
labsI$PHGBgt50 <- ifelse(labsI$PHGB>50,1,0)
ecmosI <- ddply(subset(ecmos,!is.na(patient_id)),"patient_id",function(x){
x$prbc_kg_Cum <- cumsum(x$prbc_kg)
return(x)
})
ggplot(labs2,aes(PHGB,Ferritin,group=patient_id))+geom_line()
ggplot(ecmos,aes(ecmo_hour,prbc_kg,group=patient_id))+geom_point()+facet_grid(~patient_id)
ggplot(ecmosI,aes(ecmo_hour,prbc_kg_Cum,group=patient_id))+geom_point()+geom_smooth()+facet_grid(~patient_id)
ggplot(labs2,aes(ecmo_hour,Ferritin,color=factor(patient_id)))+geom_point()+scale_y_log10()+facet_grid(~patient_id)
ggplot(labsI,aes(ecmo_hour,Ferritin,color=factor(patient_id)))+geom_point()+scale_y_log10()+facet_grid(~patient_id)
ggplot(labsI,aes(ecmo_hour,FerritinRate,color=factor(patient_id)))+geom_point()+facet_grid(~patient_id)
ggplot(labs2,aes(ecmo_hour,PHGB,color=factor(patient_id)))+geom_point()+facet_grid(~patient_id)
ggplot(labsI,aes(ecmo_hour,PHGB,color=factor(patient_id)))+geom_point()+facet_grid(~patient_id)
ggplot(labsI,aes(ecmo_hour,PHGBgt50,color=factor(patient_id)))+geom_point()+facet_grid(~patient_id)
ggplot(labsI,aes(FerritinRate,PHGBgt50,color=factor(patient_id)))+geom_point()+facet_grid(~patient_id)
ggplot(labsI,aes(factor(PHGBgt50),(FerritinRate),color=factor(patient_id)))+geom_boxplot()+facet_grid(~patient_id)
ggplot(labsI,aes(PHGBRate,FerritinRate,color=factor(patient_id)))+geom_point()+facet_grid(~patient_id)
ggplot(labsI,aes(PHGB,Ferritin,color=factor(patient_id)))+geom_line()
head(labsI)
comboData <- merge(labsI,ecomosI,by=c("patient_id","ecmo_hour"))
labs2$PHGB <- as.numeric(gsub("<","",as.character(labs2$PHGB)))
ecmos <- rbind.fill(ecmos)
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
labsI$PHGBgt50 <- ifelse(labsI$PHGB>50,1,0)
ecmosI <- ddply(subset(ecmos,!is.na(patient_id)),"patient_id",function(x){
x$prbc_kg_Cum <- cumsum(x$prbc_kg)
return(x)
})
ggplot(labs2,aes(PHGB,Ferritin,group=patient_id))+geom_line()
ggplot(ecmos,aes(ecmo_hour,prbc_kg,group=patient_id))+geom_point()+facet_grid(~patient_id)
ggplot(ecmosI,aes(ecmo_hour,prbc_kg_Cum,group=patient_id))+geom_point()+geom_smooth()+facet_grid(~patient_id)
comboData <- merge(labsI,ecomosI,by=c("patient_id","ecmo_hour"))
comboData <- merge(labsI,ecmosI,by=c("patient_id","ecmo_hour"))
head(labsI$ecmo_hour)
head(labsI$ecmo_hour)
comboData <- merge(labsI,ecmosI,by=c("patient_id","ecmo_hour_round"))
comboData <- merge(labsI,ecmosI,by=c("patient_id","ecmo_hour"),all.x=TRUE,all.y = TRUE)
labs2$PHGB <- as.numeric(gsub("<","",as.character(labs2$PHGB)))
ecmos <- rbind.fill(ecmos)
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
labsI$PHGBgt50 <- ifelse(labsI$PHGB>50,1,0)
ecmosI <- ddply(subset(ecmos,!is.na(patient_id)),"patient_id",function(x){
x$prbc_kg_Cum <- cumsum(x$prbc_kg)
return(x)
})
ggplot(labs2,aes(PHGB,Ferritin,group=patient_id))+geom_line()
ggplot(ecmos,aes(ecmo_hour,prbc_kg,group=patient_id))+geom_point()+facet_grid(~patient_id)
ggplot(ecmosI,aes(ecmo_hour,prbc_kg_Cum,group=patient_id))+geom_point()+geom_smooth()+facet_grid(~patient_id)
comboData <- merge(labsI,ecmosI,by=c("patient_id","ecmo_hour"),all.x=TRUE,all.y = TRUE)
comboDataI <- ddply(subset(comboData,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$prbc_kg_Cum <- approxfun(x$ecmo_hour,x$prbc_kg_Cum)(x$ecmo_hour)
return(x)
})
labs2$PHGB <- as.numeric(gsub("<","",as.character(labs2$PHGB)))
ecmos <- rbind.fill(ecmos)
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
labsI$PHGBgt50 <- ifelse(labsI$PHGB>50,1,0)
ecmosI <- ddply(subset(ecmos,!is.na(patient_id)),"patient_id",function(x){
x$prbc_kg_Cum <- cumsum(x$prbc_kg)
return(x)
})
ggplot(labs2,aes(PHGB,Ferritin,group=patient_id))+geom_line()
ggplot(ecmos,aes(ecmo_hour,prbc_kg,group=patient_id))+geom_point()+facet_grid(~patient_id)
ggplot(ecmosI,aes(ecmo_hour,prbc_kg_Cum,group=patient_id))+geom_point()+geom_smooth()+facet_grid(~patient_id)
comboData <- merge(labsI,ecmosI,by=c("patient_id","ecmo_hour"),all.x=TRUE,all.y = TRUE)
comboDataI <- ddply(subset(comboData,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$prbc_kg_Cum <- approxfun(x$ecmo_hour,x$prbc_kg_Cum)(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
ggplot(comboDataI,aes(prbc_kg_Cum ,FerritinRate,color=factor(patient_id)))+geom_point()+facet_grid(~patient_id)
ggplot(comboDataI,aes(prbc_kg_Cum ,FerritinRate,color=factor(patient_id)))+geom_point()+facet_grid(~patient_id)
ggplot(comboDataI,aes(prbc_kg_Cum ,PHGBRate,color=factor(patient_id)))+geom_point()+facet_grid(~patient_id)
#If TRUE then will "knit" in RStudio
if(TRUE){scriptLoader("Pena_549","read_data.R")}
Library(c("readxl","ggplot2","reshape2"))
library(plyr)
library(dplyr)
labsI$LDH
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
showProject()
require("adapr")
require("methods")
require("knitr")
paste0("Created on ",(Sys.time() ))
#If TRUE then will "knit" in RStudio
if(TRUE){scriptLoader("Pena_549","read_data.R")}
Library(c("readxl","ggplot2","reshape2"))
library(plyr)
library(dplyr)
labs <- lapply(listDatafiles()$file,function(x){readxl::read_xlsx(file.path(dataDir(),x),sheet="LabsIT")})
ecmos <- lapply(listDatafiles()$file,function(x){readxl::read_xlsx(file.path(dataDir(),x),sheet="Ecmo-K")})
labs[[5]] <- dplyr::select(labs[[5]],-date)
labs2 <- rbind.fill(labs)
labs2$PHGB <- as.numeric(gsub("<","",as.character(labs2$PHGB)))
ecmos <- rbind.fill(ecmos)
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
labs2$PHGB <- as.numeric(gsub("<","",as.character(labs2$PHGB)))
ecmos <- rbind.fill(ecmos)
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
labs2$PHGB <- as.numeric(gsub("<","",as.character(labs2$PHGB)))
ecmos <- rbind.fill(ecmos)
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
showProject()
require("adapr")
require("methods")
require("knitr")
paste0("Created on ",(Sys.time() ))
#If TRUE then will "knit" in RStudio
if(TRUE){scriptLoader("Pena_549","read_data.R")}
Library(c("readxl","ggplot2","reshape2"))
library(plyr)
library(dplyr)
labs <- lapply(listDatafiles()$file,function(x){readxl::read_xlsx(file.path(dataDir(),x),sheet="LabsIT")})
ecmos <- lapply(listDatafiles()$file,function(x){readxl::read_xlsx(file.path(dataDir(),x),sheet="Ecmo-K")})
labs[[5]] <- dplyr::select(labs[[5]],-date)
labs2 <- rbind.fill(labs)
labs2$PHGB <- as.numeric(gsub("<","",as.character(labs2$PHGB)))
ecmos <- rbind.fill(ecmos)
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
labsI$PHGBgt50 <- ifelse(labsI$PHGB>50,1,0)
ecmosI <- ddply(subset(ecmos,!is.na(patient_id)),"patient_id",function(x){
x$prbc_kg_Cum <- cumsum(x$prbc_kg)
return(x)
})
ggplot(labs2,aes(PHGB,Ferritin,group=patient_id))+geom_line()
ggplot(ecmos,aes(ecmo_hour,prbc_kg,group=patient_id))+geom_point()+facet_grid(~patient_id)
ggplot(ecmosI,aes(ecmo_hour,prbc_kg_Cum,group=patient_id))+geom_point()+geom_smooth()+facet_grid(~patient_id)
comboData <- merge(labsI,ecmosI,by=c("patient_id","ecmo_hour"),all.x=TRUE,all.y = TRUE)
comboDataI <- ddply(subset(comboData,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$prbc_kg_Cum <- approxfun(x$ecmo_hour,x$prbc_kg_Cum)(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
ggplot(labs2,aes(ecmo_hour,Ferritin,color=factor(patient_id)))+geom_point()+scale_y_log10()+facet_grid(~patient_id)
ggplot(labsI,aes(ecmo_hour,Ferritin,color=factor(patient_id)))+geom_point()+scale_y_log10()+facet_grid(~patient_id)
ggplot(labsI,aes(ecmo_hour,FerritinRate,color=factor(patient_id)))+geom_point()+facet_grid(~patient_id)
ggplot(labsI,aes(x=echmo_hour,y=PHGB))+geom_line()
ggplot(labsI,aes(x=ecmo_hour,y=PHGB))+geom_line()
ggplot(labsI,aes(x=ecmo_hour,y=PHGB,color=factor(patient_id)))+geom_line()+facet_grid(~patient_id)
ggplot(labsI,aes(x=ecmo_hour,y=PHGB,color=factor(patient_id)))+geom_line()+geom_line(aes(x=ecmo_hour,y=LDH))+facet_grid(~patient_id)
tallHemolysis <- melt(subset(labsI,select = c("patient_id","PHGB","ecmo_hour","LDH")),id.vars = "patient_id")
tallHemolysis <- melt(subset(labsI,select = c("patient_id","PHGB","ecmo_hour","LDH")),id.vars = c("patient_id","ecmo_hour"))
ggplot(tallHemolysis,aes(x=ecmo_hour,y=value,color=variable)+geom_line())+facet_grid(~patient_id)
ggplot(tallHemolysis,aes(x=ecmo_hour,y=value,color=variable))+geom_line())+facet_grid(~patient_id)
ggplot(tallHemolysis,aes(x=ecmo_hour,y=value,color=variable))+geom_line()+facet_grid(~patient_id)
ggplot(tallHemolysis,aes(x=ecmo_hour,y=scale(value),color=variable))+geom_line()+facet_grid(~patient_id)
tallHemolysis <- melt(subset(labsI,select = c("patient_id","PHGB","ecmo_hour","LDH")),id.vars = c("patient_id","ecmo_hour"))
tallHemolysis <- ddply(tallHemolysis,"variable",function(x){
x$value <- scale(x$value)
return(x)
})
ggplot(tallHemolysis,aes(x=ecmo_hour,y=scale(value),color=variable))+geom_line()+facet_grid(~patient_id)
names(labsI)
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$Transferrin <- approxfun(x$ecmo_hour,x$Transferrin,method="linear")(x$ecmo_hour)
x$Iron <-  approxfun(x$ecmo_hour,x$Iron,method="linear")(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
require("adapr")
require("methods")
require("knitr")
paste0("Created on ",(Sys.time() ))
#If TRUE then will "knit" in RStudio
if(TRUE){scriptLoader("Pena_549","read_data.R")}
Library(c("readxl","ggplot2","reshape2"))
library(plyr)
library(dplyr)
labs <- lapply(listDatafiles()$file,function(x){readxl::read_xlsx(file.path(dataDir(),x),sheet="LabsIT")})
require("adapr")
require("methods")
require("knitr")
paste0("Created on ",(Sys.time() ))
#If TRUE then will "knit" in RStudio
if(TRUE){scriptLoader("Pena_549","read_data.R")}
Library(c("readxl","ggplot2","reshape2"))
library(plyr)
library(dplyr)
labs <- lapply(listDatafiles()$file,function(x){readxl::read_xlsx(file.path(dataDir(),x),sheet="LabsIT")})
ecmos <- lapply(listDatafiles()$file,function(x){readxl::read_xlsx(file.path(dataDir(),x),sheet="Ecmo-K")})
labs[[5]] <- dplyr::select(labs[[5]],-date)
labs2 <- rbind.fill(labs)
labs2$PHGB <- as.numeric(gsub("<","",as.character(labs2$PHGB)))
ecmos <- rbind.fill(ecmos)
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$Transferrin <- approxfun(x$ecmo_hour,x$Transferrin,method="linear")(x$ecmo_hour)
x$Iron <-  approxfun(x$ecmo_hour,x$Iron,method="linear")(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
labs2$PHGB <- as.numeric(gsub("<","",as.character(labs2$PHGB)))
ecmos <- rbind.fill(ecmos)
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$Transferrin <- approxfun(x$ecmo_hour,x$Transferrin,method="linear")(x$ecmo_hour)
x$Iron <-  approxfun(x$ecmo_hour,x$Iron,method="linear")(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
require("adapr")
require("methods")
require("knitr")
paste0("Created on ",(Sys.time() ))
#If TRUE then will "knit" in RStudio
if(TRUE){scriptLoader("Pena_549","read_data.R")}
Library(c("readxl","ggplot2","reshape2"))
library(plyr)
library(dplyr)
labs <- lapply(listDatafiles()$file,function(x){readxl::read_xlsx(file.path(dataDir(),x),sheet="LabsIT")})
ecmos <- lapply(listDatafiles()$file,function(x){readxl::read_xlsx(file.path(dataDir(),x),sheet="Ecmo-K")})
labs[[5]] <- dplyr::select(labs[[5]],-date)
labs2 <- rbind.fill(labs)
labs2$PHGB <- as.numeric(gsub("<","",as.character(labs2$PHGB)))
ecmos <- rbind.fill(ecmos)
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$Transferrin <- approxfun(x$ecmo_hour,x$Transferrin,method="linear")(x$ecmo_hour)
x$Iron <-  approxfun(x$ecmo_hour,x$Iron,method="linear")(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
labs2$PHGB <- as.numeric(gsub("<","",as.character(labs2$PHGB)))
ecmos <- rbind.fill(ecmos)
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$Transferrin <- approxfun(x$ecmo_hour,x$Transferrin,method="linear")(x$ecmo_hour)
x$Iron <-  approxfun(x$ecmo_hour,x$Iron,method="linear")(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
require("adapr")
require("methods")
require("knitr")
paste0("Created on ",(Sys.time() ))
#If TRUE then will "knit" in RStudio
if(TRUE){scriptLoader("Pena_549","read_data.R")}
Library(c("readxl","ggplot2","reshape2"))
library(plyr)
library(dplyr)
labs <- lapply(listDatafiles()$file,function(x){readxl::read_xlsx(file.path(dataDir(),x),sheet="LabsIT")})
ecmos <- lapply(listDatafiles()$file,function(x){readxl::read_xlsx(file.path(dataDir(),x),sheet="Ecmo-K")})
labs[[5]] <- dplyr::select(labs[[5]],-date)
labs2 <- rbind.fill(labs)
labs2$PHGB <- as.numeric(gsub("<","",as.character(labs2$PHGB)))
ecmos <- rbind.fill(ecmos)
labsI <- ddply(subset(labs2,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$LDH <- approxfun(x$ecmo_hour,x$LDH,method="linear")(x$ecmo_hour)
x$Transferrin <- approxfun(x$ecmo_hour,x$Transferrin,method="linear")(x$ecmo_hour)
x$Iron <-  approxfun(x$ecmo_hour,x$Iron,method="linear")(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
labsI$PHGBgt50 <- ifelse(labsI$PHGB>50,1,0)
ecmosI <- ddply(subset(ecmos,!is.na(patient_id)),"patient_id",function(x){
x$prbc_kg_Cum <- cumsum(x$prbc_kg)
return(x)
})
ggplot(labs2,aes(PHGB,Ferritin,group=patient_id))+geom_line()
ggplot(ecmos,aes(ecmo_hour,prbc_kg,group=patient_id))+geom_point()+facet_grid(~patient_id)
ggplot(ecmosI,aes(ecmo_hour,prbc_kg_Cum,group=patient_id))+geom_point()+geom_smooth()+facet_grid(~patient_id)
comboData <- merge(labsI,ecmosI,by=c("patient_id","ecmo_hour"),all.x=TRUE,all.y = TRUE)
comboDataI <- ddply(subset(comboData,!is.na(patient_id)),"patient_id",function(x){
print(subset(x,select=c("patient_id","Ferritin","PHGB")))
x$Ferritin <- approxfun(x$ecmo_hour,x$Ferritin)(x$ecmo_hour)
print(x$patient_id[1])
x$PHGB <- approxfun(x$ecmo_hour,x$PHGB)(x$ecmo_hour)
x$prbc_kg_Cum <- approxfun(x$ecmo_hour,x$prbc_kg_Cum)(x$ecmo_hour)
x$FerritinRate <- c(0,diff(log(x$Ferritin))/diff(x$ecmo_hour))
x$PHGBRate <- c(0,diff(log(x$PHGB))/diff(x$ecmo_hour))
return(x)
})
ggplot(labs2,aes(ecmo_hour,Ferritin,color=factor(patient_id)))+geom_point()+scale_y_log10()+facet_grid(~patient_id)
ggplot(labsI,aes(ecmo_hour,Ferritin,color=factor(patient_id)))+geom_point()+scale_y_log10()+facet_grid(~patient_id)
ggplot(labsI,aes(ecmo_hour,FerritinRate,color=factor(patient_id)))+geom_point()+facet_grid(~patient_id)
tallHemolysis <- melt(subset(labsI,select = c("patient_id","PHGB","ecmo_hour","LDH")),id.vars = c("patient_id","ecmo_hour"))
tallHemolysis <- ddply(tallHemolysis,"variable",function(x){
x$value <- scale(x$value)
return(x)
})
ggplot(tallHemolysis,aes(x=ecmo_hour,y=scale(value),color=variable))+geom_line()+facet_grid(~patient_id)
tallHemolysis <- melt(subset(labsI,select = c("patient_id","PHGB","ecmo_hour","LDH","Transferrin","Iron")),id.vars = c("patient_id","ecmo_hour"))
tallHemolysis <- ddply(tallHemolysis,"variable",function(x){
x$value <- scale(x$value)
return(x)
})
ggplot(tallHemolysis,aes(x=ecmo_hour,y=scale(value),color=variable))+geom_line()+facet_grid(~patient_id)
tallHemolysis$Grouping <- mapvalues(tallHemolysis,c("Iron","Ferritin","Transferrin","LDH","PHGB"),c("Iron Dynamics","Iron Dynamics","Iron Dynamics",
"Hemolysis","Hemolysis"))
tallHemolysis$Grouping <- mapvalues(tallHemolysis$variable,c("Iron","Ferritin","Transferrin","LDH","PHGB"),c("Iron Dynamics","Iron Dynamics","Iron Dynamics",
"Hemolysis","Hemolysis"))
tallHemolysis <- melt(subset(labsI,select = c("patient_id","PHGB","ecmo_hour","LDH","Ferritin","Transferrin","Iron")),id.vars = c("patient_id","ecmo_hour"))
tallHemolysis <- ddply(tallHemolysis,"variable",function(x){
x$value <- scale(x$value)
return(x)
})
tallHemolysis$Grouping <- mapvalues(tallHemolysis$variable,c("Iron","Ferritin","Transferrin","LDH","PHGB"),c("Iron Dynamics","Iron Dynamics","Iron Dynamics",
"Hemolysis","Hemolysis"))
ggplot(tallHemolysis,aes(x=ecmo_hour,y=scale(value),color=variable))+geom_line()+facet_grid(~patient_id)
ggplot(tallHemolysis,aes(x=ecmo_hour,y=scale(value),color=variable))+geom_line()+facet_grid(Grouping~patient_id)
ecmosSmooth <- subset(ecmos,select=c("patient_id","prbc_kg_Cum","ecmo_hour"))
ecmosSmooth <- subset(ecmosI,select=c("patient_id","prbc_kg_Cum","ecmo_hour"))
ecmosSmooth$variable <-"prbc_kg_Cum"
ecmosSmooth$value <-ecmosSmooth$prbc_kg_Cum
tallHemolysis <- melt(subset(labsI,select = c("patient_id","PHGB","ecmo_hour","LDH","Ferritin","Transferrin","Iron")),id.vars = c("patient_id","ecmo_hour"))
tallHemolysis <-  rbind.fill(tallHemolysis,ecmosSmooth)
tallHemolysis <- ddply(tallHemolysis,"variable",function(x){
x$value <- scale(x$value)
return(x)
})
table(tallHemolysis$variable)
tallHemolysis <- melt(subset(labsI,select = c("patient_id","PHGB","ecmo_hour","LDH","Ferritin","Transferrin","Iron")),id.vars = c("patient_id","ecmo_hour"))
tallHemolysis <-  rbind.fill(tallHemolysis,ecmosSmooth)
tallHemolysis <- ddply(tallHemolysis,"variable",function(x){
x$value <- scale(x$value)
return(x)
})
tallHemolysis$Grouping <- mapvalues(tallHemolysis$variable,c("Iron","Ferritin","Transferrin","LDH","PHGB","prbc_kg_Cum"),c("Iron Dynamics","Iron Dynamics","Iron Dynamics",
"Hemolysis","Hemolysis","Transfusion History"))
ggplot(tallHemolysis,aes(x=ecmo_hour,y=scale(value),color=variable))+geom_line()+facet_grid(Grouping~patient_id)
temp <- ggplot(tallHemolysis,aes(x=ecmo_hour,y=scale(value),color=variable))+geom_line()+facet_grid(Grouping~patient_id)
Graph("longitudinal_groupings.pdf","for poster",width=12,height=8)
pdf(file.path(resultsDir,"longitudinal_groupings.pdf"),width=12,height=8)
pdf(file.path(resultsDir(),"longitudinal_groupings.pdf"),width=12,height=8)
print(temp)
graphics.off()
showResults()
setProject("Weiner_SNP")
showProject()
